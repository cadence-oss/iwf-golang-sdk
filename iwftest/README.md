## Unit tests APIs for iWF 

The APIs are generated by the below commands:
```shell
  mockgen -source=iwf/persistence.go -package=iwftest -destination=iwftest/persistence.go
  mockgen -source=iwf/communication.go -package=iwftest -destination=iwftest/communication.go
  mockgen -source=iwf/workflow_context.go -package=iwftest -destination=iwftest/workflow_context.go
```

## Usage

See the [samples](https://github.com/indeedeng/iwf-golang-samples) for more details:

```go
package subscription

import (
	"github.com/golang/mock/gomock"
	"github.com/indeedeng/iwf-golang-sdk/iwf"
	"github.com/indeedeng/iwf-golang-sdk/iwftest"
	"github.com/stretchr/testify/assert"
	"testing"
	"time"
)

var mockWfCtx *iwftest.MockWorkflowContext
var mockPersistence *iwftest.MockPersistence
var mockCommunication *iwftest.MockCommunication
var emptyCmdResults = iwf.CommandResults{}
var emptyObj = iwftest.NewTestObject(nil)
var mockSvc *MockMyService

func beforeEach(t *testing.T) {
	ctrl := gomock.NewController(t)

	mockSvc = NewMockMyService(ctrl)
	mockWfCtx = iwftest.NewMockWorkflowContext(ctrl)
	mockPersistence = iwftest.NewMockPersistence(ctrl)
	mockCommunication = iwftest.NewMockCommunication(ctrl)
}


func TestInitState_Start(t *testing.T) {
	beforeEach(t)

	state := NewInitState()

	mockPersistence.EXPECT().SetDataObject(keyCustomer, testCustomer)
	cmdReq, err := state.Start(mockWfCtx, testCustomerObj, mockPersistence, mockCommunication)
	assert.Nil(t, err)
	assert.Equal(t, iwf.EmptyCommandRequest(), cmdReq)
}


func TestTrialState_Start(t *testing.T) {
	beforeEach(t)

	state := NewTrialState(mockSvc)

	mockSvc.EXPECT().sendEmail(testCustomer.Email, gomock.Any(), gomock.Any())
	mockPersistence.EXPECT().GetDataObject(keyCustomer, gomock.Any()).SetArg(1, testCustomer)
	cmdReq, err := state.Start(mockWfCtx, emptyObj, mockPersistence, mockCommunication)
	assert.Nil(t, err)
	firingTime := cmdReq.Commands[0].TimerCommand.FiringUnixTimestampSeconds
	assert.Equal(t, iwf.AllCommandsCompletedRequest(
		iwf.NewTimerCommand("", time.Unix(firingTime, 0)),
	), cmdReq)
}

```
